An XML external entity attack (also known as XXE attack) is an attack against an application that parses XML data.
This attack occurs when XML data containing a reference to an external entity is processed by a weakly configured XML parser.

The XML standard defines entities as a way of representing an item of data within an XML document, instead of using the data itself. For example, the `&lt;` entity in HTML represents the `<` character.
An external entity is a local or remote resource/file that is referenced by a URI. Thus, if an XML parser wants to determine the value of the external entity, namely the content of the resource, the parser must load the resource.

The most basic attack is to use an XXE attack to retrieve the content of files on the server.
Let's assume, an application expects the following XML file and outputs the value of `productId` on a web page.

<pre class="language-markup line-numbers"><code>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;productId>381&lt;/productId>
</code></pre>

An attacker can manipulate the XML document such that it contains a malicous external entity that refers to the file `/etc/passwd`:

<pre class="language-markup line-numbers" data-line="3"><code>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
&lt;productId>&xxe;&lt;/productId>
</code></pre>

When the parser parses the XML file and encounters the external entity, it determines the value of the entity by loading the content of the file `/etc/passwd` and includes the content of the file at the corresponding position.
In other words, the `&xxe;` entity is replaced by the contents of the file `/etc/passwd`. The parsed XML file could look like this:

<pre class="language-markup line-numbers" data-line="3-5"><code>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
&lt;productId>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin&lt;/productId>
</code></pre>

If the web application then outputs the contents of `productId` on a web page, the attacker can indirectly **retrieve the content of the file on the server**.

Another attack scenario is that the external entity refers to a URL (e.g., `localhost:8080/deleteDB`) that is then requested by the XML parser.
As the XML parser is located on the server, the attacker may be able to **make requests to an unintended location like an internal system**.
This is kind of attack is known as a server-side request forgery (also known as SSRF).

The following XML parsers are vulnerable to XXE attacks by default:

<pre class="language-java line-numbers"><code>
DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
SAXParserFactory factory = SAXParserFactory.newInstance();
XMLInputFactory factory = XMLInputFactory.newInstance();
TransformerFactory factory = javax.xml.transform.TransformerFactory.newInstance();
SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
SAXReader xmlReader = new SAXReader();
SAXBuilder builder = new SAXBuilder();
</code></pre>
